<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Scout Room 24</title>
    <style>
        /* CSS ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏™‡∏ß‡∏¢‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÅ‡∏≠‡∏õ */
        * { box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background-color: #fafafa; margin: 0; padding-bottom: 90px; }
        header { background: #fff; padding: 15px; text-align: center; border-bottom: 1px solid #dbdbdb; position: sticky; top: 0; z-index: 100; }
        header h1 { font-size: 18px; margin: 0; color: #5d4037; }
        #feed { width: 100%; max-width: 500px; margin: 0 auto; }
        .post { background: #fff; border-bottom: 1px solid #efefef; margin-bottom: 15px; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .post img { width: 100%; display: block; background: #eee; min-height: 200px; }
        .post-content { padding: 15px; }
        .btn-open-modal {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 65px; height: 65px; background: #2e7d32; color: white;
            border-radius: 50%; border: none; font-size: 40px; cursor: pointer; z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
        .modal-content { background: white; width: 100%; position: absolute; bottom: 0; padding: 30px; border-radius: 25px 25px 0 0; text-align: center; }
        textarea { width: 100%; height: 100px; margin: 15px 0; border: 1px solid #dbdbdb; border-radius: 10px; padding: 12px; font-size: 16px; outline: none; }
        .btn-post { background: #0095f6; color: white; border: none; padding: 15px; border-radius: 10px; width: 100%; font-size: 16px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <header><h1>üå≤ SCOUT ROOM 24 üå≤</h1></header>
    <div id="feed"></div>

    <button class="btn-open-modal" onclick="toggleModal(true)">+</button>

    <div id="postModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-top:0;">üì∏ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà</h3>
            <input type="file" id="imageInput" accept="image/*" style="margin-bottom:10px;">
            <textarea id="captionInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
            <button class="btn-post" id="postBtn" onclick="addNewPost()">‡πÅ‡∏ä‡∏£‡πå‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
            <button onclick="toggleModal(false)" style="margin-top:15px; border:none; background:none; color:#999; cursor:pointer;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        const firebaseConfig = {
            apiKey: "AIzaSyDQwpiCLNLu4DQrBawxvyYA62ATmAYYKRs",
            authDomain: "scoutroom24.firebaseapp.com",
            projectId: "scoutroom24",
            storageBucket: "scoutroom24.firebasestorage.app",
            messagingSenderId: "863717190356",
            appId: "1:863717190356:web:ad6bf171a7dff9d808e941"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function toggleModal(show) {
            document.getElementById('postModal').style.display = show ? 'block' : 'none';
        }

        // 2. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
        db.collection("posts").orderBy("timestamp", "desc").onSnapshot((snapshot) => {
            const feed = document.getElementById('feed');
            feed.innerHTML = ""; 
            snapshot.forEach((doc) => {
                const data = doc.data();
                const postDiv = document.createElement('div');
                postDiv.className = 'post';
                postDiv.innerHTML = `
                    <div style="padding:12px; font-weight:600; font-size:14px;">üë§ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠ 24</div>
                    <img src="${data.imageUrl}" loading="lazy">
                    <div class="post-content">
                        <p style="margin:0; font-size:14px;">${data.caption || ''}</p>
                    </div>
                `;
                feed.appendChild(postDiv);
            });
        });

        // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î (‡πÉ‡∏ä‡πâ API Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á‡∏à‡∏∞‡∏ä‡∏±‡∏ß‡∏£‡πå‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
        async function addNewPost() {
            const fileInput = document.getElementById('imageInput');
            const captionInput = document.getElementById('captionInput');
            const postBtn = document.getElementById('postBtn');
            const file = fileInput.files[0];

            if (!file) return alert("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö!");

            postBtn.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå...";
            postBtn.disabled = true;

            try {
                // ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏õ ImgBB
                const formData = new FormData();
                formData.append("image", file);
                
                // *** ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô API Key ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á ***
                const apiKey = "953b0a985d91136a7dca903586d3f298"; 
                
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firestore
                    await db.collection("posts").add({
                        imageUrl: result.data.url,
                        caption: captionInput.value,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    // ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ñ‡πà‡∏≤
                    captionInput.value = '';
                    fileInput.value = '';
                    toggleModal(false);
                } else {
                    throw new Error("ImgBB ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                }
            } catch (error) {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message);
            } finally {
                postBtn.innerText = "‡πÅ‡∏ä‡∏£‡πå‡πÇ‡∏û‡∏™‡∏ï‡πå";
                postBtn.disabled = false;
            }
        }
    </script>
</body>
</html>
