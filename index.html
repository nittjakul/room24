<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Scout Room 24</title>
    <style>
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏ö‡∏ö‡πÅ‡∏≠‡∏õ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
        * { box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background-color: #ffffff; margin: 0; padding-bottom: 90px; color: #262626; }
        header { background: #fff; padding: 10px; text-align: center; border-bottom: 1px solid #efefef; position: sticky; top: 0; z-index: 100; }
        header h1 { font-size: 18px; margin: 0; color: #5d4037; }
        #feed { width: 100%; max-width: 500px; margin: 0 auto; }
        .post { border-bottom: 1px solid #efefef; margin-bottom: 10px; }
        .post-header { padding: 12px; font-weight: 600; font-size: 14px; display: flex; align-items: center; }
        .avatar { width: 30px; height: 30px; background: #ddd; border-radius: 50%; margin-right: 10px; }
        .post img { width: 100%; height: auto; display: block; background: #f0f0f0; }
        .post-content { padding: 12px; }
        .post-caption { font-size: 14px; margin: 0; }
        
        /* ‡∏õ‡∏∏‡πà‡∏° Post ‡∏ß‡∏á‡∏Å‡∏•‡∏° */
        .btn-open-modal {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 60px; height: 60px; background: #2e7d32; color: white;
            border-radius: 50%; border: none; font-size: 35px; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 1000;
        }

        /* Modal GUI */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
        .modal-content { background: white; width: 100%; position: absolute; bottom: 0; padding: 25px; border-radius: 20px 20px 0 0; }
        textarea { width: 100%; height: 100px; margin: 15px 0; border: 1px solid #dbdbdb; border-radius: 8px; padding: 12px; font-size: 16px; }
        .btn-post { background: #0095f6; color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-size: 16px; font-weight: bold; }
        .btn-close { position: absolute; top: 15px; right: 20px; font-size: 24px; border: none; background: none; color: #999; }
    </style>
</head>
<body>

    <header><h1>üèïÔ∏è SCOUT ROOM 24</h1></header>

    <div id="feed">
        </div>

    <button class="btn-open-modal" onclick="toggleModal(true)">+</button>

    <div id="postModal" class="modal">
        <div class="modal-content">
            <button class="btn-close" onclick="toggleModal(false)">&times;</button>
            <h3 style="margin: 0; text-align: center;">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà</h3>
            <input type="file" id="imageInput" accept="image/*" style="margin-top:20px;">
            <textarea id="captionInput" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏Ñ‡∏õ‡∏ä‡∏±‡πà‡∏ô..."></textarea>
            <button class="btn-post" onclick="addNewPost()">‡πÅ‡∏ä‡∏£‡πå‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

    <script>
        // 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase (‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
        const firebaseConfig = {
            apiKey: "AIzaSyDQwpiCLNLu4DQrBawxvyYA62ATmAYYKRs",
            authDomain: "scoutroom24.firebaseapp.com",
            projectId: "scoutroom24",
            storageBucket: "scoutroom24.firebasestorage.app",
            messagingSenderId: "863717190356",
            appId: "1:863717190356:web:ad6bf171a7dff9d808e941",
            measurementId: "G-QNTS6Q643L"
        };

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á Post
        function toggleModal(show) {
            document.getElementById('postModal').style.display = show ? 'block' : 'none';
        }

        // 2. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á (Real-time)
        db.collection("posts").orderBy("timestamp", "desc").onSnapshot((snapshot) => {
            const feed = document.getElementById('feed');
            feed.innerHTML = ""; 
            snapshot.forEach((doc) => {
                const data = doc.data();
                const postDiv = document.createElement('div');
                postDiv.className = 'post';
                postDiv.innerHTML = `
                    <div class="post-header"><div class="avatar"></div><span>‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠‡∏´‡πâ‡∏≠‡∏á 24</span></div>
                    <img src="${data.imageUrl}">
                    <div class="post-content"><p class="post-caption"><b>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô:</b> ${data.caption || ''}</p></div>
                `;
                feed.appendChild(postDiv);
            });
        });

        // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
       async function addNewPost() {
    const fileInput = document.getElementById('imageInput');
    const captionInput = document.getElementById('captionInput');
    const file = fileInput.files[0];

    if (!file) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö!");

    const btn = document.querySelector('.btn-post');
    btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...";
    btn.disabled = true;

    try {
        // --- 1. ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡πÑ‡∏õ‡∏ó‡∏µ‡πà ImgBB (‡∏ü‡∏£‡∏µ 100%) ---
        const formData = new FormData();
        formData.append("image", file);
        
        // ‡πÉ‡∏™‡πà API Key ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        const apiKey = "953b0a985d91136a7dca903586d3f298"; 
        
        const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
            method: "POST",
            body: formData
        });
        const result = await response.json();
        const url = result.data.url; // ‡πÑ‡∏î‡πâ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß!

        // --- 2. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Firestore (‡∏≠‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡∏ü‡∏£‡∏µ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ï‡∏£) ---
        await db.collection("posts").add({
            imageUrl: url,
            caption: captionInput.value,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        // ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
        captionInput.value = '';
        fileInput.value = '';
        toggleModal(false);
        alert("‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");

    } catch (error) {
        console.error(error);
        alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message);
    } finally {
        btn.innerText = "‡πÅ‡∏ä‡∏£‡πå‡πÇ‡∏û‡∏™‡∏ï‡πå";
        btn.disabled = false;
    }
}
