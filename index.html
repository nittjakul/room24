<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Scout Room 24</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background-color: #fafafa; margin: 0; padding-bottom: 90px; }
        header { background: #fff; padding: 15px; text-align: center; border-bottom: 1px solid #dbdbdb; position: sticky; top: 0; z-index: 100; }
        #feed { width: 100%; max-width: 500px; margin: 0 auto; }
        .post { background: #fff; border-bottom: 1px solid #efefef; margin-bottom: 15px; }
        .post img { width: 100%; display: block; }
        .post-content { padding: 12px; }
        
        /* Floating Button */
        .btn-open-modal {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 60px; height: 60px; background: #2e7d32; color: white;
            border-radius: 50%; border: none; font-size: 35px; cursor: pointer; z-index: 1000;
        }

        /* Modal GUI */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
        .modal-content { background: white; width: 100%; position: absolute; bottom: 0; padding: 25px; border-radius: 20px 20px 0 0; text-align: center; }
        textarea { width: 100%; height: 100px; margin: 15px 0; border: 1px solid #dbdbdb; border-radius: 8px; padding: 12px; font-size: 16px; }
        .btn-post { background: #0095f6; color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-size: 16px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

    <header><h2>üèïÔ∏è SCOUT ROOM 24</h2></header>
    <div id="feed"></div>

    <button class="btn-open-modal" onclick="toggleModal(true)">+</button>

    <div id="postModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-top:0;">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏û‡∏™‡∏ï‡πå‡πÉ‡∏´‡∏°‡πà</h3>
            <input type="file" id="imageInput" accept="image/*">
            <textarea id="captionInput" placeholder="‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÅ‡∏Ñ‡∏õ‡∏ä‡∏±‡πà‡∏ô..."></textarea>
            <button class="btn-post" onclick="addNewPost()">‡πÅ‡∏ä‡∏£‡πå‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
            <button onclick="toggleModal(false)" style="margin-top:10px; background:none; border:none; color:red;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <script>
        // 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Firebase (‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)
        const firebaseConfig = {
            apiKey: "AIzaSyDQwpiCLNLu4DQrBawxvyYA62ATmAYYKRs",
            authDomain: "scoutroom24.firebaseapp.com",
            projectId: "scoutroom24",
            storageBucket: "scoutroom24.firebasestorage.app",
            messagingSenderId: "863717190356",
            appId: "1:863717190356:web:ad6bf171a7dff9d808e941"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function toggleModal(show) {
            document.getElementById('postModal').style.display = show ? 'block' : 'none';
        }

        // 2. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
        db.collection("posts").orderBy("timestamp", "desc").onSnapshot((snapshot) => {
            const feed = document.getElementById('feed');
            feed.innerHTML = ""; 
            snapshot.forEach((doc) => {
                const data = doc.data();
                const postDiv = document.createElement('div');
                postDiv.className = 'post';
                postDiv.innerHTML = `
                    <div style="padding:10px; font-weight:bold;">‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠‡∏´‡πâ‡∏≠‡∏á 24</div>
                    <img src="${data.imageUrl}">
                    <div class="post-content"><p><b>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô:</b> ${data.caption || ''}</p></div>
                `;
                feed.appendChild(postDiv);
            });
        });

        // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î (‡πÉ‡∏ä‡πâ ImgBB ‡πÅ‡∏ó‡∏ô Firebase Storage)
        async function addNewPost() {
            const fileInput = document.getElementById('imageInput');
            const captionInput = document.getElementById('captionInput');
            const file = fileInput.files[0];

            if (!file) {
                alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö!");
                return;
            }

            const btn = document.querySelector('.btn-post');
            btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...";
            btn.disabled = true;

            try {
                // ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏õ ImgBB
                const formData = new FormData();
                formData.append("image", file);
                
                const imgbbResponse = await fetch('https://api.imgbb.com/1/upload?key=5f84d6676f6259f972008f40778c1995', {
                    method: 'POST',
                    body: formData
                });
                
                const imgbbData = await imgbbResponse.json();
                
                if (imgbbData.success) {
                    const url = imgbbData.data.url;

                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Firestore
                    await db.collection("posts").add({
                        imageUrl: url,
                        caption: captionInput.value,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp()
                    });

                    captionInput.value = '';
                    fileInput.value = '';
                    toggleModal(false);
                } else {
                    throw new Error("‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                }
            } catch (error) {
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + error.message);
                console.error(error);
            } finally {
                btn.innerText = "‡πÅ‡∏ä‡∏£‡πå‡πÇ‡∏û‡∏™‡∏ï‡πå";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
